### 从在浏览器输入地址到渲染页面，经历了什么？ Dns，浏览器端渲染，前端代码优化，写出高性能代码

#### 网络通信 

+ 应用层 -> 传输层 -> 网路层 -> 数据链路层

+ **浏览器中输入url**

  1. 用户输入url，例如http://[www.baidu.com](http://www.baidu.com/)。其中http为协议，[www.baidu.com](http://www.baidu.com/)为网络地址，及指出需要的资源在那台计算机上。一般网络地址可以为域名或IP地址，此处为域名。使用域名是为了方便记忆，但是为了让计算机理解这个地址还需要把它解析为IP地址。

  2. ping baidu.com 可获取百度的ip地址

+ **Dns解析域名**
1. 浏览器先查询hosts文件是否有与这个域名对应的ip地址，如果有则直接向这个ip地址发起http请求。查询不到就进行下一步
  
2. 浏览器向本地DNS服务器发出解析域名的DNS解析报文，本地DNS服务器收到请求后，先查询缓存，判断是否有对应的记录，如果有就返回这条记录，查询不到就进行下一步
  
3. 本地DNS服务器没有在缓存中查询到对应的记录，本地DNS服务器于是就向DNS根服务器发起查询请求。DNS根服务器收到请求通过查询得到顶级域名对应的顶级域服务器的ip地址，然后向本地DNS服务器发送一条应答报文
  
4. 本地DNS服务器收到应答报文后，得到顶级域服务器的地址，然后向该地址发送请求解析域名的DNS请求报文
  
5. 顶级域名服务器在收到请求后先查询缓存是否有对应的记录，如果有就返回对应的记录，如果没有找到就查询域名对应的二级域服务器地址，然后将域名对应的二级域服务器地址返回给本地DNS服务器
  
6. 本地DNS服务器收到应答报文后，得到二级域服务器的地址，然后向该地址发送请求解析域名的DNS请求报文
  
7. 二级域服务器在收到请求后先查询缓存是否有对应的记录，如果有就返回对应的记录，如果没有找到就查询域名对应的三级域服务器地址，然后将域名对应的三级域服务器地址返回给本地DNS服务器
  
8. 本地DNS服务器收到应答报文后，得到三级域服务器的地址，然后向该地址发送请求解析域名的DNS请求报文
  
9. 三级域服务器在收到请求后在DNS区域数据库中查询对应的记录，返回对应的记录
  
10. 本地名称服务器在收到三级域服务器后，向用户返回一条DNS应答报文，并将这条记录保存在缓存中
  
11. 浏览器就得到了域名对应的ip地址，然后就可以发起http请求了

+ **浏览器向服务器发起TCP连接**

  1. 三次握手
     1. 发送端 SYN（同步序列编号）=1而ACK（确认字符）=0 请求连接
     2. 接收端 SYN=1 ACK=1 同意连接
     3. 发送端 ACK=1 连接成功

+ **浏览器向服务器发起Http请求**

+ **服务器处理收到的请求报文**

+ **返回结果给浏览器**

+ **关闭TCP链接**

  1. 四次挥手
     1. 浏览器发送一个FIN，用来关闭浏览器到服务器的数据传送，浏览器进入FIN_WAIT_1状态
     2. 服务器收到FIN后，发送一个ACK=FIN+1给浏览器（确认序号为收到序号+1）（与SYN相同，一个FIN占用一个序号），服务器进入CLOSE_WAIT状态。此时TCP链接处于半关闭状态，即浏览器已经没有要发送的数据了，但服务器若发送数据，则客户端仍要接收
     3. 服务器发送一个FIN，用来关闭服务器到浏览器的数据传送，服务器进入LAST_ACK状态
     4. 浏览器收到FIN后，浏览器进入TIME_WAIT状态，接着发送一个ACK=FIN+1给服务器（确认序号为收到序号+1），服务器进入CLOSED状态，完成四次挥手

+ 浏览器渲染页面

#### 页面渲染

+ **页面渲染顺序**

  1. html解析->外部样式、脚本加载->外部样式执行->外部脚本执行->html继续解析->dom树构建完成->加载图片->页面加载完成

+ **优化方案**

  1. js代码会阻断html解析，但是css又会阻断js的解析，所以页面顺序css，html，js
  2. 异步加载js
     1. defer 会在页面加载完之后解析
     2. async 异步加载，不会阻塞html的解析
  3. css会阻塞图片的加载，因为不确定图片的样式，所以图片的宽高可以用标签属性

+ **重排重绘**

  1. 重绘。颜色，背景色等不改变尺寸的变化

  2. 重排。影响到位置的变化

  3. 会破坏浏览器缓存一些重排重绘的操作

     offsetTop, offsetLeft, offsetWidth, offsetHeight，scrollTop/Left/Width/Height，clientTop/Left/Width/Height，IE中的 getComputedStyle(), 或 currentStyle 这些需要获取实时位置和大小的操作都会破坏浏览器的自身的优化

  4. 如何减少重排重绘

     1. 不要逐条修改样式，通过切换classname
     2. 将动画的dom节点设置脱离文档流
     3. 将dom元素先隐藏，修改完再显示，只会产生一次的改变
     4. 别使用table

+ 性能优化

  1. 提升html的加载速度
     1. 移除内嵌的js，css
     2. 压缩
  2. css
     1. 避免嵌套过深
     2. css从右到左匹配，所以避免后代选择器，使用子选择器
     3. 避免使用通配符
  3. js

